<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Life Alchemy - Simulador de Vida</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#5D5CDE',
                        secondary: '#8B5CF6',
                    }
                }
            }
        }
    </script>
    <style>
        .stat-bar {
            transition: width 0.5s ease-in-out;
        }
        .element-card {
            transition: all 0.3s ease;
        }
        .element-card:hover {
            transform: translateY(-2px);
        }
        .combination-glow {
            animation: pulse 2s infinite;
            box-shadow: 0 0 20px rgba(93, 92, 222, 0.5);
        }
        @keyframes fadeInUp {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .fade-in-up {
            animation: fadeInUp 0.5s ease-out;
        }
    </style>
</head>
<body class="bg-gray-100 dark:bg-gray-900 text-gray-800 dark:text-gray-200 min-h-screen">
    <div class="container mx-auto px-4 py-6 max-w-6xl">
        <!-- Identity Selection Screen -->
        <div id="identitySelection" class="text-center">
            <div class="bg-white dark:bg-gray-800 rounded-lg p-8 shadow-lg max-w-2xl mx-auto">
                <h1 class="text-4xl font-bold text-primary mb-4">üß¨ Life Alchemy</h1>
                <p class="text-gray-600 dark:text-gray-400 mb-8">Tu aventura est√° a punto de comenzar...</p>
                
                <h2 class="text-2xl font-semibold mb-6">¬øC√≥mo quieres vivir tu vida?</h2>
                
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-8">
                    <button onclick="selectIdentity('ni√±o')" class="identity-option bg-blue-100 dark:bg-blue-900 hover:bg-blue-200 dark:hover:bg-blue-800 p-6 rounded-lg transition-colors border-2 border-transparent hover:border-blue-500">
                        <div class="text-4xl mb-3">üë¶</div>
                        <div class="text-xl font-semibold text-blue-800 dark:text-blue-200">Ni√±o</div>
                        <div class="text-sm text-blue-600 dark:text-blue-300 mt-2">Experimenta la vida desde una perspectiva masculina</div>
                    </button>
                    
                    <button onclick="selectIdentity('ni√±a')" class="identity-option bg-pink-100 dark:bg-pink-900 hover:bg-pink-200 dark:hover:bg-pink-800 p-6 rounded-lg transition-colors border-2 border-transparent hover:border-pink-500">
                        <div class="text-4xl mb-3">üëß</div>
                        <div class="text-xl font-semibold text-pink-800 dark:text-pink-200">Ni√±a</div>
                        <div class="text-sm text-pink-600 dark:text-pink-300 mt-2">Experimenta la vida desde una perspectiva femenina</div>
                    </button>
                    
                    <button onclick="selectIdentity('queer')" class="identity-option bg-purple-100 dark:bg-purple-900 hover:bg-purple-200 dark:hover:bg-purple-800 p-6 rounded-lg transition-colors border-2 border-transparent hover:border-purple-500">
                        <div class="text-4xl mb-3">üåà</div>
                        <div class="text-xl font-semibold text-purple-800 dark:text-purple-200">Queer</div>
                        <div class="text-sm text-purple-600 dark:text-purple-300 mt-2">Explora tu identidad de manera fluida y aut√©ntica</div>
                    </button>
                </div>
                
                <p class="text-sm text-gray-500 dark:text-gray-400">Tu elecci√≥n influir√° en las experiencias y oportunidades que encuentres en tu viaje</p>
            </div>
        </div>

        <!-- Game Content (initially hidden) -->
        <div id="gameContent" class="hidden">
            <!-- Header -->
            <div class="text-center mb-6">
                <h1 class="text-4xl font-bold text-primary mb-2">üß¨ Life Alchemy</h1>
                <p class="text-gray-600 dark:text-gray-400">Vive tu vida, combina experiencias, desbloquea tu potencial</p>
                <div class="text-sm text-gray-500 dark:text-gray-500 mt-2">
                    Jugando como: <span id="selectedIdentity" class="font-semibold"></span>
                </div>
            </div>

        <!-- Game Stats -->
        <div class="bg-white dark:bg-gray-800 rounded-lg p-6 mb-6 shadow-lg">
            <div class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-4">
                <div>
                    <div class="text-sm text-gray-600 dark:text-gray-400">Edad</div>
                    <div class="text-2xl font-bold" id="age">5</div>
                </div>
                <div>
                    <div class="text-sm text-gray-600 dark:text-gray-400">Etapa</div>
                    <div class="text-lg font-semibold" id="stage">Infancia</div>
                </div>
                <div>
                    <div class="text-sm text-gray-600 dark:text-gray-400">Elementos</div>
                    <div class="text-2xl font-bold text-primary" id="elementCount">3</div>
                </div>
                <div>
                    <div class="text-sm text-gray-600 dark:text-gray-400">Puntos</div>
                    <div class="text-2xl font-bold text-green-600" id="score">0</div>
                </div>
            </div>
            
            <!-- Stats Bars -->
            <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                <div>
                    <div class="flex justify-between text-sm mb-1">
                        <span>üí™ F√≠sico</span>
                        <span id="physicalValue">50</span>
                    </div>
                    <div class="bg-gray-200 dark:bg-gray-700 rounded-full h-3">
                        <div class="bg-red-500 h-3 rounded-full stat-bar" style="width: 50%" id="physicalBar"></div>
                    </div>
                </div>
                <div>
                    <div class="flex justify-between text-sm mb-1">
                        <span>üß† Mental</span>
                        <span id="mentalValue">50</span>
                    </div>
                    <div class="bg-gray-200 dark:bg-gray-700 rounded-full h-3">
                        <div class="bg-blue-500 h-3 rounded-full stat-bar" style="width: 50%" id="mentalBar"></div>
                    </div>
                </div>
                <div>
                    <div class="flex justify-between text-sm mb-1">
                        <span>‚ù§Ô∏è Social</span>
                        <span id="socialValue">50</span>
                    </div>
                    <div class="bg-gray-200 dark:bg-gray-700 rounded-full h-3">
                        <div class="bg-green-500 h-3 rounded-full stat-bar" style="width: 50%" id="socialBar"></div>
                    </div>
                </div>
            </div>
        </div>

        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
            <!-- Story/Events Panel -->
            <div class="bg-white dark:bg-gray-800 rounded-lg p-6 shadow-lg">
                <h2 class="text-2xl font-bold mb-4">üìñ Tu Historia</h2>
                <div id="storyContent" class="mb-4 min-h-40 max-h-60 overflow-y-auto">
                    <div class="fade-in-up">
                        <p class="mb-4">Eres un ni√±o de 5 a√±os lleno de curiosidad. El mundo es grande y misterioso, y cada d√≠a traes nuevas experiencias.</p>
                        <p class="text-primary font-semibold">¬øQu√© quieres hacer hoy?</p>
                    </div>
                </div>
                
                <div id="choices" class="space-y-2">
                    <button class="w-full text-left p-3 bg-gray-50 dark:bg-gray-700 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-600 transition-colors" onclick="makeChoice('curious')">
                        üîç Explorar el jard√≠n y hacer preguntas
                    </button>
                    <button class="w-full text-left p-3 bg-gray-50 dark:bg-gray-700 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-600 transition-colors" onclick="makeChoice('active')">
                        üèÉ Correr y jugar con energ√≠a
                    </button>
                    <button class="w-full text-left p-3 bg-gray-50 dark:bg-gray-700 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-600 transition-colors" onclick="makeChoice('social')">
                        üë• Intentar hacer amigos en el parque
                    </button>
                </div>
            </div>

            <!-- Elements & Combinations Panel -->
            <div class="bg-white dark:bg-gray-800 rounded-lg p-6 shadow-lg">
                <h2 class="text-2xl font-bold mb-4">üß™ Laboratorio de Vida</h2>
                <p class="text-sm text-gray-600 dark:text-gray-400 mb-4">Arrastra elementos para combinarlos y descubrir nuevos aspectos de tu personalidad</p>
                
                <!-- Combination Area -->
                <div class="bg-gray-50 dark:bg-gray-700 rounded-lg p-4 mb-4 min-h-20 border-2 border-dashed border-gray-300 dark:border-gray-600" id="combinationArea">
                    <div class="text-center text-gray-500 dark:text-gray-400" id="combinationPrompt">
                        Arrastra dos elementos aqu√≠ para combinarlos
                    </div>
                </div>

                <!-- Elements Grid -->
                <div class="grid grid-cols-3 gap-2 mb-4" id="elementsGrid">
                    <!-- Elements will be populated by JavaScript -->
                </div>

                <!-- Discovered Elements -->
                <div class="mt-4">
                    <h3 class="font-semibold mb-2">üìö Descubrimientos Recientes</h3>
                    <div id="recentDiscoveries" class="text-sm text-gray-600 dark:text-gray-400">
                        <p>Combina elementos para desbloquear nuevas oportunidades...</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Progress Bar -->
        <div class="mt-6 bg-white dark:bg-gray-800 rounded-lg p-4 shadow-lg">
            <div class="flex justify-between text-sm mb-2">
                <span>Progreso de Vida</span>
                <span id="lifeProgress">5%</span>
            </div>
            <div class="bg-gray-200 dark:bg-gray-700 rounded-full h-4">
                <div class="bg-gradient-to-r from-primary to-secondary h-4 rounded-full transition-all duration-1000" style="width: 5%" id="lifeProgressBar"></div>
            </div>
        </div>
        </div>
    </div>

    <script>
        // Game State
        let gameState = {
            identity: null,
            age: 5,
            stage: 'Infancia',
            stats: { physical: 50, mental: 50, social: 50 },
            score: 0,
            elements: ['Curiosidad', 'Energ√≠a', 'Inocencia'],
            discovered: [],
            combinations: [],
            selectedElements: []
        };

        // Element combinations and their effects
        const combinations = {
            'Curiosidad+Energ√≠a': { result: 'Explorador', stats: { mental: 10, physical: 5 }, description: 'Tu sed de conocimiento y energ√≠a te convierten en un explorador nato.' },
            'Curiosidad+Inocencia': { result: 'So√±ador', stats: { mental: 8, social: 5 }, description: 'Tu mente curiosa e inocente crea mundos de fantas√≠a.' },
            'Energ√≠a+Inocencia': { result: 'Juguet√≥n', stats: { physical: 8, social: 8 }, description: 'Tu energ√≠a e inocencia te hacen irresistible para otros ni√±os.' },
            'Explorador+So√±ador': { result: 'Aventurero', stats: { mental: 15, physical: 10 }, description: 'Combinas sue√±os con acci√≥n para crear aventuras √©picas.' },
            'Explorador+Juguet√≥n': { result: 'L√≠der Natural', stats: { social: 15, physical: 5 }, description: 'Tu capacidad de explorar y conectar con otros te convierte en l√≠der.' },
            'So√±ador+Juguet√≥n': { result: 'Artista', stats: { mental: 12, social: 10 }, description: 'Tu imaginaci√≥n y carisma florecen en expresi√≥n art√≠stica.' },
            'L√≠der Natural+Artista': { result: 'Visionario', stats: { mental: 20, social: 15 }, description: 'Combinas liderazgo y creatividad para inspirar a otros.' },
            
            // Resilience combinations
            'Dolor+Valent√≠a': { result: 'Resiliente', stats: { mental: 15, physical: 5 }, description: 'El dolor te ha ense√±ado a ser fuerte. Nada puede quebrantarte ahora.' },
            'Rechazo+Autenticidad': { result: 'Rebelde', stats: { mental: 10, social: -5 }, description: 'El rechazo social te ha ense√±ado a valorar tu verdadero yo por encima de todo.' },
            'Verg√ºenza+Sensibilidad': { result: 'Emp√°tico Profundo', stats: { mental: 12, social: 8 }, description: 'Tu propia verg√ºenza te permite entender el dolor de otros de manera √∫nica.' },
            'Resiliente+Rebelde': { result: 'Activista', stats: { mental: 20, social: 10 }, description: 'Tu resistencia y rebeld√≠a te convierten en una voz de cambio.' },
            'Resiliente+Emp√°tico Profundo': { result: 'Sanador', stats: { mental: 18, social: 15 }, description: 'Tu resistencia y empat√≠a te permiten ayudar a otros a sanar.' },
            'Rebelde+Emp√°tico Profundo': { result: 'Revolucionario', stats: { mental: 25, social: 5 }, description: 'Combinas la rebeld√≠a con la comprensi√≥n profunda para cambiar el mundo.' },

            // Professional & Skill combinations
            'Aventurero+Constructor': { result: 'Ingeniero', stats: { mental: 15, physical: 8 }, description: 'Tu esp√≠ritu aventurero y habilidades de construcci√≥n te hacen un ingeniero nato.' },
            'Narradora+Artista': { result: 'Escritora', stats: { mental: 18, social: 10 }, description: 'Combinas narrativa y arte para crear historias cautivadoras.' },
            'Competitivo+Disciplina': { result: 'Atleta Elite', stats: { physical: 20, mental: 8 }, description: 'Tu naturaleza competitiva y disciplina te llevan a la √©lite deportiva.' },
            'Sabidur√≠a+Amistad': { result: 'Consejero', stats: { mental: 15, social: 15 }, description: 'Tu sabidur√≠a combinada con habilidades sociales te hace un consejero natural.' },
            'Atleta+Disciplina': { result: 'Campe√≥n', stats: { physical: 18, mental: 10 }, description: 'La combinaci√≥n de talento atl√©tico y disciplina te lleva al campeonato.' },
            'Acad√©mico+Especialista': { result: 'Investigador', stats: { mental: 25, social: -5 }, description: 'Tu educaci√≥n acad√©mica y especializaci√≥n te convierten en un investigador experto.' },
            'Emprendedor+Ambicioso': { result: 'CEO', stats: { mental: 20, social: 5 }, description: 'Tu esp√≠ritu emprendedor y ambici√≥n te llevan a dirigir grandes organizaciones.' },
            'Viajero+Sociable': { result: 'Diplom√°tico', stats: { mental: 12, social: 20 }, description: 'Tus viajes y habilidades sociales te preparan para la diplomacia internacional.' },
            'Altruismo+Mentor': { result: 'Fil√°ntropo', stats: { mental: 10, social: 20 }, description: 'Tu altruismo y mentor√≠a se expanden para ayudar a comunidades enteras.' },
            
            // Creative combinations
            'Creativo+Naturalista': { result: 'Artista de la Naturaleza', stats: { mental: 15, physical: 8 }, description: 'Tu creatividad inspirada por la naturaleza crea arte √∫nico y poderoso.' },
            'Rom√°ntico+Artista': { result: 'Poeta', stats: { mental: 18, social: 12 }, description: 'Tu naturaleza rom√°ntica y art√≠stica florece en la poes√≠a.' },
            'Rebeld√≠a+Creativo': { result: 'Artista Revolucionario', stats: { mental: 20, social: 5 }, description: 'Tu rebeld√≠a se expresa a trav√©s del arte que desaf√≠a el status quo.' },
            'Fil√≥sofe+Reflexivo': { result: 'Sabio Moderno', stats: { mental: 25, social: 8 }, description: 'Tu filosof√≠a y reflexi√≥n te convierten en una fuente de sabidur√≠a contempor√°nea.' },
            
            // Social & Leadership combinations  
            'L√≠der Natural+Profesional': { result: 'Ejecutivo', stats: { mental: 15, social: 18 }, description: 'Tu liderazgo natural se perfecciona en el mundo profesional.' },
            'Sociable+Compa√±ero': { result: 'Networker', stats: { social: 22, mental: 8 }, description: 'Tu naturaleza sociable y capacidad de conectar te hace un networker excepcional.' },
            'Padre/Madre+Sabio': { result: 'Patriarca/Matriarca', stats: { social: 20, mental: 15 }, description: 'Tu experiencia como padre/madre y sabidur√≠a te convierten en el pilar de la familia.' },
            'Activista Comunitario+Legado': { result: 'Changemaker', stats: { mental: 18, social: 18 }, description: 'Tu activismo comunitario construye un legado de cambio positivo.' },
            'Maestro+Paz Interior': { result: 'Gur√∫', stats: { mental: 20, social: 15 }, description: 'Tu sabidur√≠a como maestro y paz interior inspiran a otros en sus caminos espirituales.' },
            
            // Wellness & Balance combinations
            'Saludable+Paz Interior': { result: 'Zen Master', stats: { mental: 18, physical: 15 }, description: 'Tu equilibrio entre salud f√≠sica y paz mental te da una perspectiva zen de la vida.' },
            'Inversionista+Ambicioso': { result: 'Magnate', stats: { mental: 18, social: 8 }, description: 'Tu visi√≥n financiera y ambici√≥n te convierten en un magnate de los negocios.' },
            'Crisis+Reflexivo': { result: 'Renacido', stats: { mental: 20, social: 5 }, description: 'Tu crisis existencial seguida de reflexi√≥n profunda te ha renovado completamente.' },
            
            // Identity-based combinations
            'Autenticidad Feroz+Pionere': { result: 'L√≠der LGBTQ+', stats: { mental: 18, social: 15 }, description: 'Tu autenticidad y esp√≠ritu pionero te convierte en un l√≠der de la comunidad LGBTQ+.' },
            'Determinaci√≥n+Hermandad': { result: 'Feminista', stats: { mental: 15, social: 18 }, description: 'Tu determinaci√≥n y hermandad femenina te hacen una voz fuerte para los derechos de las mujeres.' },
            'Valent√≠a Emocional+Red de Apoyo': { result: 'Terapeuta', stats: { mental: 20, social: 18 }, description: 'Tu valent√≠a emocional y red de apoyo te preparan para ayudar a otros con sus problemas.' },
            
            // Advanced meta-combinations
            'Visionario+Investigador': { result: 'Innovador', stats: { mental: 30, social: 10 }, description: 'Tu visi√≥n y capacidad de investigaci√≥n te permiten innovar y cambiar paradigmas.' },
            'Revolucionario+Changemaker': { result: 'Transformador Social', stats: { mental: 25, social: 25 }, description: 'Tu capacidad revolucionaria y de cambio social transforma sociedades enteras.' },
            'CEO+Fil√°ntropo': { result: 'L√≠der Visionario', stats: { mental: 25, social: 25 }, description: 'Combinas √©xito empresarial con impacto social para liderar el cambio global.' },
            'Zen Master+Gur√∫': { result: 'Enlightened', stats: { mental: 30, physical: 20, social: 20 }, description: 'Has alcanzado un nivel de iluminaci√≥n que inspira y transforma a todos a tu alrededor.' },

            // Additional logical combinations
            'Observaci√≥n+Sabidur√≠a': { result: 'Cient√≠fico', stats: { mental: 20, physical: -2 }, description: 'Tu capacidad de observar y tu sabidur√≠a te convierten en un investigador meticuloso.' },
            'Atletismo+Competitivo': { result: 'Deportista Profesional', stats: { physical: 22, mental: 5 }, description: 'Tu atletismo natural y esp√≠ritu competitivo te llevan al deporte profesional.' },
            'Diversi√≥n+Sociable': { result: 'Animador', stats: { social: 18, physical: 8 }, description: 'Tu naturaleza divertida y social te convierte en el alma de cada reuni√≥n.' },
            'Responsabilidad+Disciplina': { result: 'L√≠der Confiable', stats: { mental: 12, social: 15 }, description: 'Tu sentido del deber y disciplina generan confianza en otros.' },
            'Talento+Especialista': { result: 'Virtuoso', stats: { mental: 20, social: 10 }, description: 'Tu talento natural refinado por especializaci√≥n te hace excepcional en tu campo.' },
            'Autoconocimiento+Reflexivo': { result: 'Psic√≥logo', stats: { mental: 22, social: 12 }, description: 'Tu autoconocimiento y reflexi√≥n te permiten entender la mente humana.' },
            'Fiestero+Networker': { result: 'Influencer', stats: { social: 25, mental: 5 }, description: 'Tu vida social intensa y habilidades de networking te dan influencia masiva.' },
            'Saludable+Atleta Elite': { result: 'Entrenador Personal', stats: { physical: 20, social: 15 }, description: 'Tu salud √≥ptima y atletismo elite te permiten entrenar a otros.' },
            'Abuelo/a+Patriarca/Matriarca': { result: 'Anciano Sabio', stats: { mental: 25, social: 20 }, description: 'Tu experiencia como abuelo y pilar familiar te da sabidur√≠a ancestral.' },
            'Innovador+Transformador Social': { result: 'Visionario del Futuro', stats: { mental: 35, social: 20 }, description: 'Combinas innovaci√≥n tecnol√≥gica con transformaci√≥n social para cambiar el mundo.' },
            
            // More creative combinations
            'Naturalista+Viajero': { result: 'Explorador Natural', stats: { mental: 15, physical: 12 }, description: 'Tu amor por la naturaleza y los viajes te convierte en un explorador de ecosistemas.' },
            'Poeta+Sabio Moderno': { result: 'Escritor Filos√≥fico', stats: { mental: 28, social: 15 }, description: 'Tu poes√≠a y sabidur√≠a moderna crean literatura que toca el alma.' },
            'Diplom√°tico+Changemaker': { result: 'Pacificador Global', stats: { mental: 20, social: 30 }, description: 'Tu diplomacia y activismo construyen puentes hacia la paz mundial.' },
            'Investigador+Innovador': { result: 'Premio Nobel', stats: { mental: 40, social: 10 }, description: 'Tu investigaci√≥n e innovaci√≥n revolucionan el conocimiento humano.' },
            'Terapeuta+Sanador': { result: 'Sanador Integral', stats: { mental: 25, social: 25 }, description: 'Combinas terapia psicol√≥gica con sanaci√≥n hol√≠stica para ayudar integralmente.' },
            
            // Professional growth combinations
            'Profesional+Ejecutivo': { result: 'Director General', stats: { mental: 18, social: 20 }, description: 'Tu experiencia profesional y habilidades ejecutivas te llevan a la alta direcci√≥n.' },
            'Compa√±ero+Padre/Madre': { result: 'Familia Estable', stats: { social: 25, mental: 10 }, description: 'Tu capacidad de ser buen compa√±ero y padre/madre crea una familia s√≥lida.' },
            'Emprendedor+CEO': { result: 'Fundador Exitoso', stats: { mental: 25, social: 15 }, description: 'Tu esp√≠ritu emprendedor y habilidades de CEO construyen un imperio empresarial.' },
            'Mentor+Maestro': { result: 'Educador Inspirador', stats: { mental: 20, social: 25 }, description: 'Tu mentor√≠a y ense√±anza inspiran a generaciones de estudiantes.' },
            'Inversionista+Magnate': { result: 'Tit√°n Financiero', stats: { mental: 25, social: 8 }, description: 'Tu visi√≥n de inversi√≥n y ambici√≥n te convierten en una fuerza financiera.' },
            
            // Healing and growth combinations
            'Renacido+Paz Interior': { result: 'Maestro Espiritual', stats: { mental: 25, social: 18 }, description: 'Tu renacimiento y paz interior te permiten guiar a otros en su transformaci√≥n.' },
            'Red de Apoyo+Comunidad': { result: 'Constructor de Redes', stats: { social: 30, mental: 12 }, description: 'Tu habilidad para crear apoyo y comunidad construye redes sociales poderosas.' },
            'Autoaceptaci√≥n+Autoamor': { result: 'Ser Completo', stats: { mental: 20, physical: 10, social: 15 }, description: 'La combinaci√≥n de autoaceptaci√≥n y autoamor te da una completitud personal extraordinaria.' },
            'Consciencia Social+Feminista': { result: 'Activista de Derechos', stats: { mental: 20, social: 25 }, description: 'Tu consciencia social y feminismo te convierten en una voz poderosa por los derechos humanos.' },
            'Pensamiento Cr√≠tico+Sabio Moderno': { result: 'Intelectual P√∫blico', stats: { mental: 30, social: 15 }, description: 'Tu pensamiento cr√≠tico y sabidur√≠a moderna te posicionan como una voz intelectual influyente.' },
        };

        // Life stages and events
        const lifeStages = {
            'Infancia': { min: 5, max: 12, events: ['curious', 'active', 'social', 'creative'] },
            'Adolescencia': { min: 13, max: 18, events: ['study', 'rebel', 'romance', 'sport'] },
            'Juventud': { min: 19, max: 30, events: ['career', 'travel', 'relationship', 'education'] },
            'Adultez': { min: 31, max: 55, events: ['family', 'business', 'mentor', 'crisis'] },
            'Madurez': { min: 56, max: 80, events: ['wisdom', 'legacy', 'health', 'reflection'] }
        };

        function updateDisplay() {
            document.getElementById('age').textContent = gameState.age;
            document.getElementById('stage').textContent = gameState.stage;
            document.getElementById('elementCount').textContent = gameState.elements.length;
            document.getElementById('score').textContent = gameState.score;
            
            // Update stats
            ['physical', 'mental', 'social'].forEach(stat => {
                const value = Math.max(0, Math.min(100, gameState.stats[stat]));
                document.getElementById(stat + 'Value').textContent = value;
                document.getElementById(stat + 'Bar').style.width = value + '%';
            });

            // Update life progress
            const progress = Math.min(100, (gameState.age / 80) * 100);
            document.getElementById('lifeProgress').textContent = Math.round(progress) + '%';
            document.getElementById('lifeProgressBar').style.width = progress + '%';

            updateElementsGrid();
        }

        function updateElementsGrid() {
            const grid = document.getElementById('elementsGrid');
            grid.innerHTML = '';
            
            gameState.elements.forEach(element => {
                const elementDiv = document.createElement('div');
                elementDiv.className = 'element-card bg-primary text-white p-3 rounded-lg text-center cursor-pointer select-none text-sm font-medium';
                elementDiv.textContent = element;
                elementDiv.draggable = true;
                elementDiv.onclick = () => selectElement(element);
                elementDiv.ondragstart = (e) => {
                    e.dataTransfer.setData('text/plain', element);
                };
                grid.appendChild(elementDiv);
            });
        }

        function selectElement(element) {
            if (gameState.selectedElements.length < 2 && !gameState.selectedElements.includes(element)) {
                gameState.selectedElements.push(element);
                updateCombinationArea();
            }
        }

        function updateCombinationArea() {
            const area = document.getElementById('combinationArea');
            const prompt = document.getElementById('combinationPrompt');
            
            if (gameState.selectedElements.length === 0) {
                prompt.textContent = 'Arrastra dos elementos aqu√≠ para combinarlos';
                area.className = area.className.replace(' combination-glow', '');
            } else if (gameState.selectedElements.length === 1) {
                prompt.textContent = `${gameState.selectedElements[0]} + ?`;
            } else if (gameState.selectedElements.length === 2) {
                prompt.textContent = `${gameState.selectedElements[0]} + ${gameState.selectedElements[1]}`;
                area.className += ' combination-glow';
                setTimeout(tryCombination, 1000);
            }
        }

        function tryCombination() {
            const [elem1, elem2] = gameState.selectedElements;
            const combo1 = `${elem1}+${elem2}`;
            const combo2 = `${elem2}+${elem1}`;
            
            const combination = combinations[combo1] || combinations[combo2];
            
            if (combination && !gameState.elements.includes(combination.result)) {
                // Successful combination
                gameState.elements.push(combination.result);
                gameState.discovered.push(combination.result);
                
                // Apply stat changes
                Object.keys(combination.stats).forEach(stat => {
                    gameState.stats[stat] += combination.stats[stat];
                });
                
                gameState.score += 100;
                
                showDiscovery(combination);
            } else {
                showFailedCombination();
            }
            
            // Reset selection
            gameState.selectedElements = [];
            updateCombinationArea();
            updateDisplay();
        }

        function showDiscovery(combination) {
            const discoveries = document.getElementById('recentDiscoveries');
            discoveries.innerHTML = `
                <div class="fade-in-up bg-green-100 dark:bg-green-900 p-3 rounded-lg mb-2">
                    <div class="font-semibold text-green-800 dark:text-green-200">üéâ ¬°Nuevo descubrimiento!</div>
                    <div class="text-green-700 dark:text-green-300">${combination.result}: ${combination.description}</div>
                </div>
            ` + discoveries.innerHTML;
        }

        function showFailedCombination() {
            const discoveries = document.getElementById('recentDiscoveries');
            discoveries.innerHTML = `
                <div class="fade-in-up bg-yellow-100 dark:bg-yellow-900 p-3 rounded-lg mb-2">
                    <div class="text-yellow-800 dark:text-yellow-200">ü§î Esa combinaci√≥n no funcion√≥... ¬°sigue experimentando!</div>
                </div>
            ` + discoveries.innerHTML;
        }

        function makeChoice(choice) {
            const choices = {
                // Original choices
                'curious': { 
                    text: 'Tu curiosidad te lleva a descubrir cosas fascinantes. Haces muchas preguntas que impresionan a los adultos.',
                    stats: { mental: 5, social: 2 },
                    element: 'Observaci√≥n'
                },
                'active': { 
                    text: 'Corres, saltas y juegas con energ√≠a ilimitada. Tu cuerpo se vuelve m√°s fuerte y resistente.',
                    stats: { physical: 8, mental: -2 },
                    element: 'Atletismo'
                },
                'social': { 
                    text: 'Haces nuevos amigos en el parque. Aprendes a compartir y a entender las emociones de otros.',
                    stats: { social: 8, mental: 3 },
                    element: 'Empat√≠a'
                },
                // New choices from generateNewChoices
                'learn': {
                    text: 'Te concentras en aprender cosas nuevas. Lees libros, haces preguntas y tu mente se expande cada d√≠a.',
                    stats: { mental: 8, physical: -2 },
                    element: 'Sabidur√≠a'
                },
                'play': {
                    text: 'Juegas y te diviertes con otros ni√±os. Desarrollas habilidades sociales y f√≠sicas mientras te diviertes.',
                    stats: { social: 6, physical: 4 },
                    element: 'Diversi√≥n'
                },
                'help': {
                    text: 'Ayudas en casa y eres responsable. Los adultos conf√≠an en ti y desarrollas un sentido del deber.',
                    stats: { social: 5, mental: 3 },
                    element: 'Responsabilidad'
                },
                'study': {
                    text: 'Estudias duro para el futuro. Aunque a veces es dif√≠cil, sabes que la educaci√≥n abrir√° puertas.',
                    stats: { mental: 10, social: -3 },
                    element: 'Disciplina'
                },
                'friends': {
                    text: 'Pasas tiempo con amigos. Fortaleces v√≠nculos y aprendes sobre lealtad y confianza.',
                    stats: { social: 10, mental: 2 },
                    element: 'Amistad'
                },
                'hobby': {
                    text: 'Desarrollas un talento especial que te apasiona. Tu dedicaci√≥n te hace destacar.',
                    stats: { mental: 6, physical: 4 },
                    element: 'Talento'
                },
                // Infancia expanded
                'explore_nature': {
                    text: 'Exploras la naturaleza con fascinaci√≥n. Cada insecto, cada hoja, cada sonido del bosque es un descubrimiento.',
                    stats: { mental: 6, physical: 6 },
                    element: 'Naturalista'
                },
                'make_friends': {
                    text: 'Haces nuevos amigos en el colegio. Aprendes a compartir, a negociar y a resolver conflictos.',
                    stats: { social: 10, mental: 2 },
                    element: 'Sociable'
                },
                'be_creative': {
                    text: 'Expresas tu creatividad a trav√©s del arte, la m√∫sica o la escritura. Tu imaginaci√≥n no tiene l√≠mites.',
                    stats: { mental: 8, social: 4 },
                    element: 'Creativo'
                },
                // Adolescencia expanded
                'rebel': {
                    text: 'Te rebelas contra las reglas y autoridad. Aunque esto causa conflictos, desarrollas independencia.',
                    stats: { mental: 6, social: -5, physical: 3 },
                    element: 'Rebeld√≠a'
                },
                'romance': {
                    text: 'Experimentas tu primer amor. Es intenso, confuso y te ense√±a sobre vulnerabilidad y conexi√≥n.',
                    stats: { social: 8, mental: 4, physical: -2 },
                    element: 'Rom√°ntico'
                },
                'identity': {
                    text: 'Exploras qui√©n eres realmente. Experimentas con diferentes estilos, ideas y formas de expresarte.',
                    stats: { mental: 10, social: -3 },
                    element: 'Autoconocimiento'
                },
                'volunteer': {
                    text: 'Haces trabajo voluntario y ayudas a otros. Descubres el poder de hacer una diferencia positiva.',
                    stats: { social: 8, mental: 6 },
                    element: 'Altruismo'
                },
                'sports': {
                    text: 'Participas en deportes competitivos. Aprendes sobre trabajo en equipo, disciplina y perseverancia.',
                    stats: { physical: 10, social: 5, mental: 3 },
                    element: 'Atleta'
                },
                // Juventud expanded  
                'university': {
                    text: 'Vas a la universidad y expandes tu mente. Estudias, debates y formas tu visi√≥n del mundo.',
                    stats: { mental: 15, social: 5, physical: -5 },
                    element: 'Acad√©mico'
                },
                'work': {
                    text: 'Empiezas a trabajar y ganas independencia econ√≥mica. Aprendes responsabilidad y autonom√≠a.',
                    stats: { mental: 8, social: 3, physical: 2 },
                    element: 'Profesional'
                },
                'travel': {
                    text: 'Viajas y conoces el mundo. Cada lugar te ense√±a algo nuevo sobre ti mismo y la humanidad.',
                    stats: { mental: 12, social: 8, physical: 5 },
                    element: 'Viajero'
                },
                'relationship': {
                    text: 'Construyes una relaci√≥n seria y profunda. Aprendes sobre compromiso, comunicaci√≥n y amor maduro.',
                    stats: { social: 12, mental: 5, physical: 3 },
                    element: 'Compa√±ero'
                },
                'entrepreneur': {
                    text: 'Emprendes tu propio negocio. Es arriesgado pero emocionante crear algo desde cero.',
                    stats: { mental: 10, social: 3, physical: -3 },
                    element: 'Emprendedor'
                },
                'party': {
                    text: 'Disfrutas intensamente la vida social. Conoces gente, vives experiencias, pero a veces descuidas otras √°reas.',
                    stats: { social: 15, physical: -5, mental: -5 },
                    element: 'Fiestero'
                },
                'skill': {
                    text: 'Te especializas profundamente en una habilidad. Tu dedicaci√≥n te convierte en experto.',
                    stats: { mental: 15, physical: 2 },
                    element: 'Especialista'
                },
                // Adultez expanded
                'career': {
                    text: 'Te enfocas intensamente en tu carrera. Alcanzas logros profesionales pero sacrificas tiempo personal.',
                    stats: { mental: 10, social: -5, physical: -3 },
                    element: 'Ambicioso'
                },
                'family': {
                    text: 'Formas una familia y tienes hijos. Es challenging pero incre√≠blemente gratificante.',
                    stats: { social: 15, mental: 5, physical: -5 },
                    element: 'Padre/Madre'
                },
                'mentor': {
                    text: 'Becomes mentor de j√≥venes profesionales. Compartes tu conocimiento y experiencia.',
                    stats: { mental: 8, social: 10 },
                    element: 'Mentor'
                },
                'crisis': {
                    text: 'Enfrentas una crisis de mediana edad. Cuestionas tus decisiones y buscas nuevo significado.',
                    stats: { mental: 5, social: -8, physical: -5 },
                    element: 'Crisis'
                },
                'community': {
                    text: 'Te involucras activamente en tu comunidad. Organizas eventos y luchas por causas importantes.',
                    stats: { social: 12, mental: 6 },
                    element: 'Activista Comunitario'
                },
                'health': {
                    text: 'Priorizas tu salud y bienestar. Ejercitas, meditas y cuidas tu cuerpo y mente.',
                    stats: { physical: 12, mental: 6 },
                    element: 'Saludable'
                },
                'invest': {
                    text: 'Inviertes sabiamente en tu futuro financiero. Planificas para la jubilaci√≥n y estabilidad.',
                    stats: { mental: 8, social: -2 },
                    element: 'Inversionista'
                },
                // Madurez expanded
                'wisdom': {
                    text: 'Compartes tu sabidur√≠a con las nuevas generaciones. Tus experiencias son valiosas lecciones.',
                    stats: { mental: 10, social: 8 },
                    element: 'Sabio'
                },
                'legacy': {
                    text: 'Trabajas conscientemente en construir tu legado. ¬øQu√© huella quieres dejar en el mundo?',
                    stats: { mental: 12, social: 5 },
                    element: 'Legado'
                },
                'grandparent': {
                    text: 'Disfrutas enormemente ser abuelo/a. Una nueva perspectiva sobre la familia y el amor.',
                    stats: { social: 15, mental: 5 },
                    element: 'Abuelo/a'
                },
                'reflection': {
                    text: 'Reflexionas profundamente sobre tu vida vivida. Aceptas tanto los logros como los errores.',
                    stats: { mental: 15, social: -3 },
                    element: 'Reflexivo'
                },
                'teach': {
                    text: 'Ense√±as formalmente a las nuevas generaciones. Tu conocimiento se perpet√∫a en otros.',
                    stats: { mental: 8, social: 10 },
                    element: 'Maestro'
                },
                'peace': {
                    text: 'Encuentras una paz interior profunda. Has llegado a un lugar de aceptaci√≥n y serenidad.',
                    stats: { mental: 12, social: 3, physical: 5 },
                    element: 'Paz Interior'
                }
            };

            const selectedChoice = choices[choice];
            if (selectedChoice) {
                // Update story
                const storyContent = document.getElementById('storyContent');
                storyContent.innerHTML = `
                    <div class="fade-in-up">
                        <p class="mb-4">${selectedChoice.text}</p>
                        <p class="text-primary font-semibold">Tu experiencia te ha ense√±ado algo nuevo...</p>
                    </div>
                `;

                // Update stats
                Object.keys(selectedChoice.stats).forEach(stat => {
                    gameState.stats[stat] += selectedChoice.stats[stat];
                });

                // Add new element if not already present
                if (selectedChoice.element && !gameState.elements.includes(selectedChoice.element)) {
                    gameState.elements.push(selectedChoice.element);
                    gameState.score += 50;
                }

                // Age up and potentially change stage
                gameState.age += Math.floor(Math.random() * 2) + 1;
                updateLifeStage();
                
                // Generate new choices after delay
                setTimeout(() => {
                    generateNewChoices();
                }, 2000);
                
                updateDisplay();
            } else {
                console.log('Choice not found:', choice);
            }
        }

        function updateLifeStage() {
            for (const [stage, data] of Object.entries(lifeStages)) {
                if (gameState.age >= data.min && gameState.age <= data.max && gameState.stage !== stage) {
                    gameState.stage = stage;
                    showStageTransition(stage);
                    break;
                }
            }
        }

        function showStageTransition(newStage) {
            const storyContent = document.getElementById('storyContent');
            storyContent.innerHTML = `
                <div class="fade-in-up text-center">
                    <div class="text-3xl mb-4">üåü</div>
                    <div class="text-xl font-bold text-primary mb-2">¬°Nueva Etapa de Vida!</div>
                    <div class="text-lg">Has entrado en la ${newStage}</div>
                    <div class="text-sm text-gray-600 dark:text-gray-400 mt-2">Nuevas oportunidades y desaf√≠os te esperan...</div>
                </div>
            `;
        }

        function generateNewChoices() {
            // 1% chance of tragic dead end based on demographics and stage
            if (Math.random() < 0.01) {
                generateDeadEnd();
                return;
            }

            // Random chance for negative events based on identity
            if (Math.random() < 0.25) {
                generateNegativeEvent();
                return;
            }
            
            const choices = document.getElementById('choices');
            
            // Generate appropriate choices for current life stage
            const stageChoices = {
                'Infancia': [
                    { id: 'learn', text: 'üìö Concentrarte en aprender cosas nuevas' },
                    { id: 'play', text: 'üéÆ Jugar y divertirte con otros ni√±os' },
                    { id: 'help', text: 'ü§ù Ayudar en casa y ser responsable' },
                    { id: 'explore_nature', text: 'üå≥ Explorar la naturaleza y aventurarte' },
                    { id: 'make_friends', text: 'üë´ Hacer nuevos amigos en el colegio' },
                    { id: 'be_creative', text: 'üé® Ser creativo y expresarte art√≠sticamente' }
                ],
                'Adolescencia': [
                    { id: 'study', text: 'üìñ Estudiar duro para el futuro' },
                    { id: 'friends', text: 'üë´ Pasar tiempo con amigos' },
                    { id: 'hobby', text: 'üé® Desarrollar un talento especial' },
                    { id: 'rebel', text: 'üò§ Rebelarte contra las reglas' },
                    { id: 'romance', text: 'üíï Experimentar tu primer amor' },
                    { id: 'identity', text: 'ü™û Explorar tu identidad personal' },
                    { id: 'volunteer', text: 'ü§≤ Hacer trabajo voluntario' },
                    { id: 'sports', text: '‚öΩ Participar en deportes competitivos' }
                ],
                'Juventud': [
                    { id: 'university', text: 'üéì Ir a la universidad' },
                    { id: 'work', text: 'üíº Empezar a trabajar y ser independiente' },
                    { id: 'travel', text: '‚úàÔ∏è Viajar y conocer el mundo' },
                    { id: 'relationship', text: '‚ù§Ô∏è Construir una relaci√≥n seria' },
                    { id: 'entrepreneur', text: 'üöÄ Emprender tu propio negocio' },
                    { id: 'party', text: 'üéâ Disfrutar la vida social intensamente' },
                    { id: 'skill', text: 'üõ†Ô∏è Especializarte en una habilidad' }
                ],
                'Adultez': [
                    { id: 'career', text: 'üìà Enfocar en tu carrera profesional' },
                    { id: 'family', text: 'üë®‚Äçüë©‚Äçüëß‚Äçüë¶ Formar una familia' },
                    { id: 'mentor', text: 'üë®‚Äçüè´ Ser mentor de otros' },
                    { id: 'crisis', text: 'üò∞ Enfrentar una crisis de mediana edad' },
                    { id: 'community', text: 'üèòÔ∏è Involucrarte en tu comunidad' },
                    { id: 'health', text: 'üí™ Cuidar tu salud y bienestar' },
                    { id: 'invest', text: 'üí∞ Invertir en tu futuro financiero' }
                ],
                'Madurez': [
                    { id: 'wisdom', text: 'üßô‚Äç‚ôÇÔ∏è Compartir tu sabidur√≠a con otros' },
                    { id: 'legacy', text: 'üìö Construir tu legado' },
                    { id: 'grandparent', text: 'üë¥ Disfrutar ser abuelo/a' },
                    { id: 'reflection', text: 'ü§î Reflexionar sobre tu vida' },
                    { id: 'teach', text: 'üë®‚Äçüè´ Ense√±ar a las nuevas generaciones' },
                    { id: 'peace', text: '‚òÆÔ∏è Encontrar paz interior' }
                ]
            };

            const availableChoices = stageChoices[gameState.stage] || stageChoices['Infancia'];
            // Randomize and pick 3-4 choices
            const shuffled = availableChoices.sort(() => 0.5 - Math.random());
            const selectedChoices = shuffled.slice(0, Math.min(4, shuffled.length));
            
            choices.innerHTML = selectedChoices.map(choice => `
                <button class="w-full text-left p-3 bg-gray-50 dark:bg-gray-700 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-600 transition-colors" onclick="makeChoice('${choice.id}')">
                    ${choice.text}
                </button>
            `).join('');
        }

        function generateNegativeEvent() {
            const storyContent = document.getElementById('storyContent');
            const choices = document.getElementById('choices');
            
            const negativeEvents = {
                'ni√±o': [
                    {
                        id: 'crying',
                        story: 'Te sientes triste y empiezas a llorar. Algunos ni√±os se burlan diciendo "los ni√±os no lloran" y un adulto te dice que "seas fuerte como un hombre".',
                        choices: [
                            { id: 'hide_emotions', text: 'üòû Esconder tus emociones para parecer "fuerte"' },
                            { id: 'defend_emotions', text: 'üí™ Defender tu derecho a sentir emociones' },
                            { id: 'find_support', text: 'ü§ó Buscar a alguien que te entienda' }
                        ]
                    },
                    {
                        id: 'sensitive',
                        story: 'Te emocionas mucho viendo una pel√≠cula y otros ni√±os te dicen que eres "muy sensible" o "como una ni√±a". Te sientes confundido sobre si est√° bien sentir tanto.',
                        choices: [
                            { id: 'suppress_sensitivity', text: 'üôà Tratar de ser menos sensible' },
                            { id: 'embrace_sensitivity', text: '‚ù§Ô∏è Aceptar que ser sensible es normal' },
                            { id: 'question_stereotypes', text: 'ü§î Preguntarte por qu√© existen estas reglas' }
                        ]
                    }
                ],
                'ni√±a': [
                    {
                        id: 'sports',
                        story: 'Quieres jugar f√∫tbol con los ni√±os, pero te dicen que "eso no es para ni√±as" y que deber√≠as jugar con mu√±ecas. Te sientes frustrada y excluida.',
                        choices: [
                            { id: 'accept_limitation', text: 'üòî Aceptar que no puedes jugar f√∫tbol' },
                            { id: 'insist_playing', text: '‚öΩ Insistir en tu derecho a jugar lo que quieras' },
                            { id: 'find_alternative', text: 'üåü Buscar otras ni√±as que piensen como t√∫' }
                        ]
                    },
                    {
                        id: 'appearance',
                        story: 'Una t√≠a comenta que deber√≠as preocuparte m√°s por verte "bonita" y menos por ensuciarte jugando. Te hace sentir que tu valor depende de c√≥mo te ves.',
                        choices: [
                            { id: 'focus_appearance', text: 'üíÑ Empezar a preocuparte m√°s por tu apariencia' },
                            { id: 'ignore_comment', text: 'üèÉ Ignorar el comentario y seguir jugando' },
                            { id: 'question_beauty', text: 'ü§® Preguntarte por qu√© la belleza es tan importante' }
                        ]
                    }
                ],
                'queer': [
                    {
                        id: 'different',
                        story: 'Otros ni√±os notan que juegas y act√∫as diferente. Te hacen preguntas inc√≥modas y algunos adultos parecen preocupados por tu "comportamiento extra√±o".',
                        choices: [
                            { id: 'conform', text: 'üò∑ Tratar de actuar como los dem√°s esperan' },
                            { id: 'stay_authentic', text: 'üåà Mantenerte fiel a tu forma de ser' },
                            { id: 'educate_others', text: 'üìö Tratar de explicar que ser diferente est√° bien' }
                        ]
                    },
                    {
                        id: 'rejection',
                        story: 'Un grupo de ni√±os no te deja jugar con ellos porque dicen que eres "raro" y que no encajas. Te sientes solo y rechazado.',
                        choices: [
                            { id: 'change_self', text: 'üòû Cambiar para ser aceptado' },
                            { id: 'find_acceptance', text: 'üîç Buscar personas que te acepten como eres' },
                            { id: 'build_confidence', text: 'üí™ Fortalecer tu autoestima independientemente' }
                        ]
                    }
                ]
            };

            const identityEvents = negativeEvents[gameState.identity];
            const selectedEvent = identityEvents[Math.floor(Math.random() * identityEvents.length)];
            
            storyContent.innerHTML = `
                <div class="fade-in-up">
                    <p class="mb-4">${selectedEvent.story}</p>
                    <p class="text-red-600 dark:text-red-400 font-semibold">¬øC√≥mo reaccionas a esta situaci√≥n?</p>
                </div>
            `;
            
            choices.innerHTML = selectedEvent.choices.map(choice => `
                <button class="w-full text-left p-3 bg-gray-50 dark:bg-gray-700 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-600 transition-colors" onclick="handleNegativeChoice('${selectedEvent.id}', '${choice.id}')">
                    ${choice.text}
                </button>
            `).join('');
        }

        function handleNegativeChoice(eventId, choiceId) {
            const negativeResponses = {
                'ni√±o': {
                    'crying': {
                        'hide_emotions': {
                            text: 'Decides que no mostrar√°s m√°s tus emociones. Aunque esto te protege de las burlas, sientes que pierdes una parte importante de ti.',
                            stats: { social: 5, mental: -8 },
                            element: 'Represi√≥n'
                        },
                        'defend_emotions': {
                            text: 'Te mantienes firme en que sentir emociones es normal. Aunque algunos se burlan, encuentras adultos que te apoyan y valoran tu sensibilidad.',
                            stats: { mental: 8, social: -3 },
                            element: 'Valent√≠a Emocional'
                        },
                        'find_support': {
                            text: 'Buscas a personas que entiendan tus sentimientos. Descubres que hay adultos y otros ni√±os que tambi√©n sienten profundamente.',
                            stats: { social: 6, mental: 5 },
                            element: 'Red de Apoyo'
                        }
                    },
                    'sensitive': {
                        'suppress_sensitivity': {
                            text: 'Intentas ser menos sensible, pero es dif√≠cil cambiar qui√©n eres. Te sientes desconectado de ti mismo.',
                            stats: { mental: -6, social: 3 },
                            element: 'Dolor'
                        },
                        'embrace_sensitivity': {
                            text: 'Decides que tu sensibilidad es un regalo. Aunque no todos lo entiendan, t√∫ sabes que te permite conectar profundamente con el mundo.',
                            stats: { mental: 10, social: 2 },
                            element: 'Autoaceptaci√≥n'
                        },
                        'question_stereotypes': {
                            text: 'Empiezas a cuestionar por qu√© existen estas reglas sobre c√≥mo deben actuar los ni√±os. Tu mente cr√≠tica se desarrolla.',
                            stats: { mental: 8, social: -2 },
                            element: 'Pensamiento Cr√≠tico'
                        }
                    }
                },
                'ni√±a': {
                    'sports': {
                        'accept_limitation': {
                            text: 'Aceptas que no puedes jugar f√∫tbol y te conformas con actividades "apropiadas para ni√±as". Sientes que una parte de ti se marchita.',
                            stats: { physical: -5, mental: -5 },
                            element: 'Conformidad'
                        },
                        'insist_playing': {
                            text: 'Te niegas a aceptar la limitaci√≥n y peleas por tu derecho a jugar. Enfrentas resistencia pero tambi√©n encuentras apoyo.',
                            stats: { physical: 8, mental: 6, social: -3 },
                            element: 'Determinaci√≥n'
                        },
                        'find_alternative': {
                            text: 'Buscas a otras ni√±as que compartan tus intereses. Juntas crean su propio espacio para jugar lo que quieran.',
                            stats: { social: 8, mental: 5 },
                            element: 'Hermandad'
                        }
                    },
                    'appearance': {
                        'focus_appearance': {
                            text: 'Empiezas a preocuparte m√°s por c√≥mo te ves que por lo que haces. Tu autoestima se vuelve dependiente de la apariencia.',
                            stats: { social: 3, mental: -6 },
                            element: 'Inseguridad'
                        },
                        'ignore_comment': {
                            text: 'Decides que lo que otros piensan de tu apariencia no es importante. Tu confianza en ti misma se fortalece.',
                            stats: { mental: 8, physical: 5 },
                            element: 'Autoconfianza'
                        },
                        'question_beauty': {
                            text: 'Te preguntas por qu√© la sociedad valora tanto la belleza en las ni√±as. Desarrollas una perspectiva cr√≠tica sobre los est√°ndares sociales.',
                            stats: { mental: 10, social: -2 },
                            element: 'Consciencia Social'
                        }
                    }
                },
                'queer': {
                    'different': {
                        'conform': {
                            text: 'Intentas actuar como los dem√°s esperan, pero sientes que traicionas tu verdadero yo. La m√°scara se vuelve pesada.',
                            stats: { social: 5, mental: -8 },
                            element: 'Verg√ºenza'
                        },
                        'stay_authentic': {
                            text: 'Decides que ser t√∫ misme es m√°s importante que la aprobaci√≥n de otros. Tu autenticidad se convierte en tu fortaleza.',
                            stats: { mental: 10, social: -5 },
                            element: 'Autenticidad Feroz'
                        },
                        'educate_others': {
                            text: 'Intentas educar a otros sobre la diversidad. Algunos aprenden, otros no, pero plantaste semillas importantes.',
                            stats: { mental: 6, social: 3 },
                            element: 'Educadore'
                        }
                    },
                    'rejection': {
                        'change_self': {
                            text: 'Intentas cambiar para ser aceptade, pero pierdes tu esencia en el proceso. El dolor del rechazo interno es peor que el externo.',
                            stats: { social: 3, mental: -10 },
                            element: 'Rechazo'
                        },
                        'find_acceptance': {
                            text: 'Buscas espacios y personas que te acepten como eres. Descubres que existe una comunidad que te entiende.',
                            stats: { social: 8, mental: 5 },
                            element: 'Comunidad'
                        },
                        'build_confidence': {
                            text: 'Trabajas en amarte a ti misme sin depender de la validaci√≥n externa. Tu fortaleza interior crece.',
                            stats: { mental: 12, social: -2 },
                            element: 'Autoamor'
                        }
                    }
                }
            };

            const response = negativeResponses[gameState.identity][eventId][choiceId];
            if (response) {
                // Update story
                const storyContent = document.getElementById('storyContent');
                storyContent.innerHTML = `
                    <div class="fade-in-up">
                        <p class="mb-4">${response.text}</p>
                        <p class="text-primary font-semibold">Esta experiencia dif√≠cil te ha cambiado...</p>
                    </div>
                `;

                // Update stats
                Object.keys(response.stats).forEach(stat => {
                    gameState.stats[stat] += response.stats[stat];
                });

                // Add new element
                if (response.element && !gameState.elements.includes(response.element)) {
                    gameState.elements.push(response.element);
                    if (response.stats.mental >= 0) {
                        gameState.score += 75; // Growth through adversity is valuable
                    } else {
                        gameState.score += 25; // But painful experiences still teach us
                    }
                }

                // Age up
                gameState.age += Math.floor(Math.random() * 2) + 1;
                updateLifeStage();
                
                // Continue the story
                setTimeout(generateNewChoices, 3000);
                updateDisplay();
            }
        }

        // Setup drag and drop for combination area
        document.getElementById('combinationArea').addEventListener('dragover', (e) => {
            e.preventDefault();
        });

        document.getElementById('combinationArea').addEventListener('drop', (e) => {
            e.preventDefault();
            const element = e.dataTransfer.getData('text/plain');
            selectElement(element);
        });

        // Dark mode detection
        if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
            document.documentElement.classList.add('dark');
        }
        window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', event => {
            if (event.matches) {
                document.documentElement.classList.add('dark');
            } else {
                document.documentElement.classList.remove('dark');
            }
        });

        // Identity selection function
        function selectIdentity(identity) {
            gameState.identity = identity;
            document.getElementById('selectedIdentity').textContent = identity.charAt(0).toUpperCase() + identity.slice(1);
            
            // Hide identity selection and show game
            document.getElementById('identitySelection').classList.add('hidden');
            document.getElementById('gameContent').classList.remove('hidden');
            
            // Set identity-specific starting story
            initializeStory();
            updateDisplay();
        }

        function initializeStory() {
            const identityStories = {
                'ni√±o': {
                    intro: 'Eres un ni√±o de 5 a√±os lleno de curiosidad. El mundo es grande y misterioso, y cada d√≠a trae nuevas aventuras esper√°ndote.',
                    elements: ['Curiosidad', 'Energ√≠a', 'Valent√≠a']
                },
                'ni√±a': {
                    intro: 'Eres una ni√±a de 5 a√±os con una imaginaci√≥n desbordante. Todo a tu alrededor parece m√°gico y lleno de posibilidades.',
                    elements: ['Curiosidad', 'Creatividad', 'Empat√≠a']
                },
                'queer': {
                    intro: 'Eres una personita de 5 a√±os que ve el mundo de manera √∫nica. Sientes que no necesitas encajar en cajas predefinidas y eso te hace especial.',
                    elements: ['Curiosidad', 'Autenticidad', 'Sensibilidad']
                }
            };

            const story = identityStories[gameState.identity];
            gameState.elements = story.elements;
            
            const storyContent = document.getElementById('storyContent');
            storyContent.innerHTML = `
                <div class="fade-in-up">
                    <p class="mb-4">${story.intro}</p>
                    <p class="text-primary font-semibold">¬øQu√© quieres hacer hoy?</p>
                </div>
            `;
            
            generateIdentitySpecificChoices();
        }

        function generateIdentitySpecificChoices() {
            const choices = document.getElementById('choices');
            
            const identityChoices = {
                'ni√±o': [
                    { id: 'explore', text: 'üîç Explorar y buscar tesoros en el jard√≠n' },
                    { id: 'build', text: 'üèóÔ∏è Construir algo genial con bloques' },
                    { id: 'compete', text: 'üèÉ Competir corriendo con otros ni√±os' }
                ],
                'ni√±a': [
                    { id: 'imagine', text: 'üåü Crear historias m√°gicas con tus juguetes' },
                    { id: 'care', text: 'ü§ó Cuidar de tus mu√±ecas como una mam√°' },
                    { id: 'draw', text: 'üé® Dibujar y crear arte hermoso' }
                ],
                'queer': [
                    { id: 'question', text: '‚ùì Hacer preguntas sobre por qu√© las cosas son como son' },
                    { id: 'different', text: 'üåà Jugar de manera diferente a como otros esperan' },
                    { id: 'feel', text: 'üí≠ Explorar todos tus sentimientos y emociones' }
                ]
            };

            const availableChoices = identityChoices[gameState.identity];
            
            choices.innerHTML = availableChoices.map(choice => `
                <button class="w-full text-left p-3 bg-gray-50 dark:bg-gray-700 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-600 transition-colors" onclick="makeIdentityChoice('${choice.id}')">
                    ${choice.text}
                </button>
            `).join('');
        }

        function makeIdentityChoice(choice) {
            const identityResponses = {
                'ni√±o': {
                    'explore': { 
                        text: 'Encuentras una piedra brillante que decides que es un tesoro real. Tu esp√≠ritu aventurero se fortalece.',
                        stats: { mental: 6, physical: 4 },
                        element: 'Aventurero'
                    },
                    'build': { 
                        text: 'Construyes una torre impresionante que resiste todos los intentos de derribarla. Te sientes orgulloso de tu logro.',
                        stats: { mental: 8, physical: 2 },
                        element: 'Constructor'
                    },
                    'compete': { 
                        text: 'Corres tan r√°pido que sientes que vuelas. Otros ni√±os te admiran y quieren ser como t√∫.',
                        stats: { physical: 8, social: 4 },
                        element: 'Competitivo'
                    }
                },
                'ni√±a': {
                    'imagine': { 
                        text: 'Creas una historia tan hermosa que hasta los adultos se quedan escuchando fascinados. Tu imaginaci√≥n no tiene l√≠mites.',
                        stats: { mental: 8, social: 4 },
                        element: 'Narradora'
                    },
                    'care': { 
                        text: 'Cuidas de tus mu√±ecas con tanto amor que otras ni√±as quieren aprender de ti. Desarrollas un coraz√≥n compasivo.',
                        stats: { social: 8, mental: 4 },
                        element: 'Cuidadora'
                    },
                    'draw': { 
                        text: 'Tu dibujo es tan expresivo que captura emociones que las palabras no pueden describir. Eres una artista natural.',
                        stats: { mental: 6, social: 6 },
                        element: 'Artista'
                    }
                },
                'queer': {
                    'question': { 
                        text: 'Tus preguntas hacen que los adultos piensen en cosas que nunca hab√≠an considerado. Tu perspectiva √∫nica es valiosa.',
                        stats: { mental: 8, social: 4 },
                        element: 'Fil√≥sofe'
                    },
                    'different': { 
                        text: 'Juegas de una manera tan creativa que otros ni√±os se sienten libres de ser ellos mismos tambi√©n. Eres un catalizador de autenticidad.',
                        stats: { social: 6, mental: 6 },
                        element: 'Pionere'
                    },
                    'feel': { 
                        text: 'Exploras tus emociones profundamente y descubres que puedes sentir cosas que otros no entienden. Tu sensibilidad es un superpoder.',
                        stats: { mental: 6, social: 6 },
                        element: 'Emp√°tique'
                    }
                }
            };

            const response = identityResponses[gameState.identity][choice];
            if (response) {
                // Update story
                const storyContent = document.getElementById('storyContent');
                storyContent.innerHTML = `
                    <div class="fade-in-up">
                        <p class="mb-4">${response.text}</p>
                        <p class="text-primary font-semibold">Has descubierto algo nuevo sobre ti...</p>
                    </div>
                `;

                // Update stats
                Object.keys(response.stats).forEach(stat => {
                    gameState.stats[stat] += response.stats[stat];
                });

                // Add new element
                if (response.element && !gameState.elements.includes(response.element)) {
                    gameState.elements.push(response.element);
                    gameState.score += 50;
                }

                // Age up
                gameState.age += Math.floor(Math.random() * 2) + 1;
                updateLifeStage();
                
                // Generate new choices after delay
                setTimeout(() => {
                    generateNewChoices();
                }, 2000);
                
                updateDisplay();
            }
        }

        function generateDeadEnd() {
            const storyContent = document.getElementById('storyContent');
            const choices = document.getElementById('choices');
            
            const deadEnds = {
                'ni√±o': {
                    'Infancia': {
                        story: 'Un d√≠a, mientras juegas en el parque, un extra√±o se acerca ofreci√©ndote dulces. A pesar de las advertencias de tus padres, tu curiosidad infantil te traiciona.',
                        message: 'Tu historia termina aqu√≠. Esta tragedia representa las miles de desapariciones infantiles que ocurren cada a√±o. La protecci√≥n de la infancia requiere vigilancia constante de toda la sociedad.'
                    },
                    'Adolescencia': {
                        story: 'Durante una salida nocturna con amigos, decides separarte del grupo. Es la √∫ltima vez que alguien te ve.',
                        message: 'Tu historia termina aqu√≠. Esto refleja la realidad de muchos j√≥venes que desaparecen sin explicaci√≥n. La inseguridad afecta a todas las familias, especialmente en las zonas urbanas.'
                    },
                    'Juventud': {
                        story: 'Despu√©s de una noche normal en la universidad, nunca llegas a casa. Tu familia nunca obtiene respuestas.',
                        message: 'Tu historia termina aqu√≠. Las desapariciones forzadas son una realidad dolorosa. Miles de familias viven en la incertidumbre, esperando noticias que nunca llegan.'
                    },
                    'Adultez': {
                        story: 'Mientras vas al trabajo un martes cualquiera, simplemente desapareces. Tu familia busca respuestas que nunca llegan.',
                        message: 'Tu historia termina aqu√≠. La violencia y criminalidad cobran vidas inocentes diariamente. Cada estad√≠stica representa una familia destruida.'
                    }
                },
                'ni√±a': {
                    'Infancia': {
                        story: 'Mientras caminas a la escuela, alguien te lleva. Tu familia nunca vuelve a verte.',
                        message: 'Tu historia termina aqu√≠. Las ni√±as enfrentan riesgos particulares de violencia y trata. La protecci√≥n infantil debe ser una prioridad absoluta para toda sociedad.'
                    },
                    'Adolescencia': {
                        story: 'Tu primera relaci√≥n se vuelve posesiva y violenta. Una noche, la discusi√≥n va demasiado lejos.',
                        message: 'Tu historia termina aqu√≠. La violencia de pareja es la principal causa de muerte de mujeres j√≥venes. Una mujer muere cada d√≠a a manos de su pareja o ex-pareja.'
                    },
                    'Juventud': {
                        story: 'Despu√©s de terminar una relaci√≥n t√≥xica, tu ex-novio no acepta la decisi√≥n. La violencia machista reclama otra v√≠ctima.',
                        message: 'Tu historia termina aqu√≠. El feminicidio es una pandemia global. Cada 11 minutos una mujer es asesinada por violencia de g√©nero. Tu historia representa a millones.'
                    },
                    'Adultez': {
                        story: 'Una discusi√≥n dom√©stica escala hasta lo irreversible. La violencia intrafamiliar cobra otra vida.',
                        message: 'Tu historia termina aqu√≠. La violencia dom√©stica mata a m√°s mujeres que el c√°ncer, los accidentes de tr√°fico y la guerra combinados. El silencio es c√≥mplice.'
                    }
                },
                'queer': {
                    'Infancia': {
                        story: 'Otros ni√±os notan que eres "diferente". Una broma cruel en el recreo termina en tragedia.',
                        message: 'Tu historia termina aqu√≠. Los ni√±os LGBTQ+ sufren bullying extremo desde temprana edad. El rechazo familiar y social lleva a tasas alarmantes de suicidio juvenil.'
                    },
                    'Adolescencia': {
                        story: 'Decides contarle a tu familia sobre tu identidad. La reacci√≥n es peor de lo que imaginaste. El rechazo total te lleva a tomar una decisi√≥n definitiva.',
                        message: 'Tu historia termina aqu√≠. El 40% de los j√≥venes LGBTQ+ consideran el suicidio. El rechazo familiar multiplica el riesgo por 8. El amor incondicional salva vidas.'
                    },
                    'Juventud': {
                        story: 'Mientras caminas de la mano con tu pareja, un grupo de personas decide que tu amor es una "amenaza" a sus valores.',
                        message: 'Tu historia termina aqu√≠. Los cr√≠menes de odio contra personas LGBTQ+ aumentan cada a√±o. Tu identidad no es una amenaza; la intolerancia s√≠ lo es.'
                    },
                    'Adultez': {
                        story: 'Un d√≠a normal se convierte en pesadilla cuando alguien decide que tu existencia ofende sus creencias.',
                        message: 'Tu historia termina aqu√≠. La violencia por prejuicio LGBTQ+ es una realidad global. Cada persona tiene derecho a existir aut√©nticamente sin miedo.'
                    }
                }
            };

            const identityDeadEnds = deadEnds[gameState.identity];
            const stageDeadEnds = identityDeadEnds[gameState.stage] || identityDeadEnds['Infancia'];
            
            storyContent.innerHTML = `
                <div class="fade-in-up">
                    <p class="mb-4 text-red-800 dark:text-red-300">${stageDeadEnds.story}</p>
                    <div class="bg-black text-white p-4 rounded-lg mb-4">
                        <p class="font-bold text-center text-xl mb-2">GAME OVER</p>
                        <p class="text-sm">${stageDeadEnds.message}</p>
                    </div>
                    <div class="text-center">
                        <p class="text-gray-600 dark:text-gray-400 mb-4">Edad final: ${gameState.age} a√±os | Puntuaci√≥n: ${gameState.score}</p>
                        <p class="text-sm text-gray-500 dark:text-gray-500">Estas tragedias son realidades que enfrentan millones de personas. La conciencia social es el primer paso hacia el cambio.</p>
                    </div>
                </div>
            `;
            
            choices.innerHTML = `
                <button class="w-full text-center p-4 bg-primary text-white rounded-lg hover:bg-primary/80 transition-colors" onclick="location.reload()">
                    üîÑ Comenzar Nueva Vida
                </button>
                <div class="mt-4 text-center">
                    <a href="#" onclick="showResources()" class="text-sm text-primary hover:underline">
                        üìû Recursos de Ayuda y Apoyo
                    </a>
                </div>
            `;
        }

        function showResources() {
            const discoveries = document.getElementById('recentDiscoveries');
            discoveries.innerHTML = `
                <div class="bg-blue-100 dark:bg-blue-900 p-4 rounded-lg">
                    <div class="font-semibold text-blue-800 dark:text-blue-200 mb-2">üÜò Recursos de Emergencia</div>
                    <div class="text-sm text-blue-700 dark:text-blue-300">
                        <p><strong>Violencia Dom√©stica:</strong> 911 (emergencia)</p>
                        <p><strong>L√≠nea LGBT:</strong> Depende del pa√≠s</p>
                        <p><strong>Salud Mental:</strong> Servicios locales de crisis</p>
                        <p><strong>B√∫squeda de Desaparecidos:</strong> Autoridades locales</p>
                        <p class="mt-2 font-semibold">Si t√∫ o alguien que conoces est√° en peligro, busca ayuda inmediatamente.</p>
                    </div>
                </div>
            `;
        }

        // Initialize game (don't auto-start)
        // updateDisplay();
    </script>
</body>
</html>
